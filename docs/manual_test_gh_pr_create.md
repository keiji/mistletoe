# GitHub Pull Request 作成テスト設計書

本ドキュメントは、`mstl-gh` の `pr create` コマンドを使用して、複数のリポジトリにまたがる依存関係を持った Pull Request を作成する機能の手動テスト手順を定義します。

## 概要

このテストでは、以下のシナリオを検証します。

1.  複数のリポジトリの準備と初期化。
2.  各リポジトリへの変更のコミット。
3.  依存関係グラフを指定した `pr create` の実行。
4.  GitHub 上での Pull Request の作成確認。
5.  Pull Request 本文への Mistletoe ブロック（依存関係情報）の埋め込み確認。

## 前提条件

*   GitHub CLI (`gh`) がインストールされ、ログイン済みであること。
*   Git がインストールされていること。
*   テスト用の Python スクリプト実行環境が整っていること。
*   インターネットに接続されていること（GitHub API を使用するため）。

## テスト構成

*   **リポジトリ構成**: 3つのリポジトリ（A, B, C）を使用します。
*   **依存関係**: A -> B -> C (A は B に依存し、B は C に依存する)。
*   **ブランチ**: `feature/interactive-test`

## テスト手順

本テストは、`manual_tests/manual_test_gh_pr_create.py` スクリプトによって半自動化されています。

### 1. 環境セットアップ（自動）

スクリプトを実行すると、以下の処理が自動的に行われます。

1.  `mstl-gh` バイナリのビルド。
2.  一時的なリポジトリ名（`mistletoe-test-*`）の生成。

### 2. リポジトリ作成と初期化（自動）

1.  GitHub 上にテスト用リポジトリが3つ作成されます。
2.  `mstl-gh init` が実行され、ローカルにリポジトリがクローンされます。
3.  各リポジトリにダミーの Git ユーザー設定が行われます。

### 3. 変更の作成（自動）

1.  `mstl-gh switch -c feature/interactive-test` が実行され、全リポジトリでブランチが切り替わります。
2.  各リポジトリに `test.txt` が追加され、コミットされます。

### 4. `pr create` の実行（対話的）

スクリプトは以下のコマンドを実行します。

```bash
mstl-gh pr create \
  -t "Interactive Test PR" \
  -b "Testing interactive script" \
  --dependencies dependencies.md \
  --verbose
```

**操作:**
*   コマンド実行中、ツールがユーザーに入力を求めます。
*   Pull Request を作成するか問われた際、`yes` と入力します。

### 5. 検証（手動確認）

スクリプトの実行完了後、表示された URL にアクセスし、以下の点を確認します。

1.  **PRの作成**: リポジトリ A, B, C すべてに対して Pull Request が作成されていること。
2.  **依存関係の表示**:
    *   **リポジトリ A の PR**: 本文に「Dependencies」セクションがあり、リポジトリ B へのリンクが含まれていること。
    *   **リポジトリ B の PR**: 本文に「Dependents」セクションがありリポジトリ A へのリンクが、「Dependencies」セクションにリポジトリ C へのリンクが含まれていること。
    *   **リポジトリ C の PR**: 本文に「Dependents」セクションがあり、リポジトリ B へのリンクが含まれていること。
3.  **スナップショット**: 各 PR の詳細欄（Details）に、スナップショット情報が含まれていること。

## クリーンアップ

テスト終了後、スクリプトは作成した GitHub リポジトリとローカルの一時ディレクトリを削除します。
