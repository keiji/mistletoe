# 設定ファイルの解決ロジック

このドキュメントでは、`mstl` および `mstl-gh` コマンドを実行する際の設定ファイル (`.mstl/config.json`) のパス解決ロジックについて説明します。

## 概要

ツールは、以下の優先順位に基づいて使用する設定ファイルを決定します。

1.  **標準入力 (stdin)**: 設定データがコマンドにパイプされた場合、それが直接使用されます。
2.  **コマンドラインフラグ**: `--file` または `-f` が指定された場合、そのファイルが使用されます。
3.  **カレントディレクトリ**: デフォルトでカレントディレクトリの `.mstl/config.json` を使用します。
4.  **親ディレクトリの検索** (新規): カレントディレクトリに見つからない場合、特定の検証基準を満たせば、現在のGitリポジトリのルートの親ディレクトリにある設定ファイルを探そうとします。

## 親ディレクトリの検索ロジック

デフォルトの設定ファイル (`.mstl/config.json`) がカレントディレクトリに見つからず、フラグや標準入力でも指定されていない場合、以下の検索ロジックがトリガーされます。

1.  **Gitリポジトリの確認**: ツールは、カレントディレクトリがGitリポジトリ内にあるかを確認します。
2.  **親パスの解決**: Gitリポジトリ内であれば、そのリポジトリのルートを特定し、その親ディレクトリにある `.mstl/config.json` を探します (`../.mstl/config.json`)。
3.  **検証**: 親ディレクトリに設定ファイルが見つかった場合、現在のディレクトリ構成が設定と一致するかを検証します。
    *   設定で定義された各リポジトリについて:
        *   親ディレクトリ内にリポジトリIDを持つディレクトリが存在するかを確認します。
        *   そのディレクトリがGitリポジトリであるかを確認します。
        *   そのGitリポジトリの `origin` リモートURLが設定で定義されたURLと一致するかを検証します。
4.  **通知と自動切り替え**:
    *   検証に成功した場合、ツールは以下のメッセージを表示し、自動的にその設定を使用します。
        > "No .mstl found in current directory, but found one in {parent}. Using that configuration."

    *   **重要**: プロセスの実行コンテキスト（カレントディレクトリ）は、発見された設定ファイルが存在する親ディレクトリに切り替わります。これにより、相対パスで定義されたリポジトリの操作が正しく行われます。

5.  **フォールバック**:
    *   検証に失敗した場合、ツールは元の「設定ファイルが見つからない」エラーを報告します。

## 背景

この機能は、`mstl` で管理されている特定のリポジトリ内で作業する際の開発者体験を向上させます。これにより、構造が一貫している限り、ルートまで移動したり手動で設定ファイルパスを指定したりすることなく、管理されたサブリポジトリ内から `mstl` コマンドを実行できるようになります。
