# mstl sync 競合処理手動テスト設計書

本書は、`mstl sync` コマンド実行時にマージ競合（Conflict）が発生した場合の挙動を検証する手動テスト手順を定義します。

## 1. 概要 (Overview)

`mstl sync` は、リモートリポジトリの変更を取り込む際に、競合が発生した場合は処理を中断し、ユーザーに解決を委ねる必要があります。本テストでは、意図的に競合状態を作り出し、ツールが適切にエラー終了することを検証します。

## 2. 前提条件 (Prerequisites)

*   `manual_tests/manual_test_sync_conflict.py` スクリプトによって自動化されています。
*   ローカル環境でのベア Git リポジトリを使用するため、GitHub 認証は不要です。

## 3. テストシナリオ (Test Scenarios)

### 3.1. 競合発生時の同期中断

1.  **セットアップ**:
    *   一時ディレクトリにベア Git リポジトリ（リモート）を作成。
    *   ローカルにクローンし、初期コミットを Push。

2.  **競合の注入**:
    *   **リモート側**: 別のクローン（Seed）で同じファイルの同じ行を変更し、Push する。
    *   **ローカル側**: テスト対象のローカルリポジトリで、同じファイルの同じ行を異なる内容に変更し、コミットする。

3.  **`status` 確認**:
    *   `mstl status` を実行。
    *   **期待される結果**: 競合（`!`）または分岐状態が表示されること。

4.  **`sync` 実行**:
    *   `mstl sync` を実行（対話プロンプトには `merge` 戦略などを想定して応答、または自動化）。

5.  **検証**:
    *   `git pull` (または `merge`) が失敗し、`mstl` が非ゼロの終了コードで終了すること。
    *   標準出力または標準エラー出力に "CONFLICT" または適切なエラーメッセージが含まれていること。
    *   処理が中断され、誤って成功扱いになっていないこと。

## 4. 内部ロジック (Internal Logic)

*   スクリプトは `InteractiveRunner` を使用してユーザー確認を行った後に実行されます。
*   `git` コマンドを使用して競合状態をプログラム的に生成します。
*   `mstl` の実行は `subprocess` を介して行い、終了コードと出力を解析します。
