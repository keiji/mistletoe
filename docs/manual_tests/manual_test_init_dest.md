# 初期化先ディレクトリ検証テスト設計書

本ドキュメントは、`mstl init` コマンドの出力先ディレクトリ（`--dest` フラグ）に関するバリデーションおよび動作を検証するための手動テスト手順を定義します。

## 概要

このテストでは、以下のシナリオを検証します。

1.  指定された出力先が既存のファイルである場合のエラーハンドリング。
2.  親ディレクトリが存在しない場合のエラーハンドリング。
3.  出力先ディレクトリ内に、クローン対象と競合する空ではないディレクトリ（Gitリポジトリではない）が存在する場合のエラーハンドリング。
4.  出力先が空のディレクトリである場合の正常系動作。
5.  出力先ディレクトリが存在せず、親ディレクトリが存在する場合の新規作成および正常系動作。
6.  `--dest` フラグを省略した場合のデフォルト動作（カレントディレクトリへの展開）。

## 前提条件

*   Go がインストールされており、`mstl` のビルドが可能であること。
*   Git がインストールされていること。
*   Python 3 がインストールされていること。

## テスト構成

スクリプト `manual_tests/manual_test_init_dest.py` は、一時的な作業ディレクトリ内に以下を作成してテストを行います。

*   **ベア Git リポジトリ**: クローン元のダミーリモートリポジトリとして機能します。
*   **設定ファイル**: 上記のベア Git リポジトリを参照する `config.json`。

## テストケース詳細

### ケース 1: 出力先がファイル

*   **条件**: `--dest` で指定したパスに同名のファイルが存在する。
*   **期待結果**: 初期化に失敗し、「specified path is a file」（または同等の意味のエラーメッセージ）が表示されること。

### ケース 2: 親ディレクトリ欠落

*   **条件**: `--dest` で指定したパスの親ディレクトリが存在しない（例: `missing_parent/target` で `missing_parent` がない）。
*   **期待結果**: 初期化に失敗し、「parent directory does not exist」（または同等の意味のエラーメッセージ）が表示されること。

### ケース 3: 出力先が空ではない（競合あり）

*   **条件**: 出力先ディレクトリ内に、設定ファイルで定義されたリポジトリIDと同名のサブディレクトリが存在し、かつそのサブディレクトリが空ではなく、有効な Git リポジトリでもない。
*   **期待結果**: 初期化に失敗し、「directory ... exists, is not empty」（または同等の意味のエラーメッセージ）が表示されること。

### ケース 4: 出力先が空ディレクトリ

*   **条件**: `--dest` で指定したパスが既存の空ディレクトリである。
*   **期待結果**:
    *   コマンドが成功する。
    *   指定したディレクトリ内にリポジトリがクローンされる。

### ケース 5: 出力先の新規作成

*   **条件**: `--dest` で指定したパスが存在しないが、その親ディレクトリは存在する。
*   **期待結果**:
    *   コマンドが成功する。
    *   指定したディレクトリが新規作成され、その中にリポジトリがクローンされる。

### ケース 6: デフォルト出力先（カレントディレクトリ）

*   **条件**: `--dest` フラグを省略して実行する。
*   **期待結果**:
    *   コマンドが成功する。
    *   コマンドを実行したカレントディレクトリ内にリポジトリがクローンされる。

## テスト手順

以下のコマンドを実行することで、全テストケースが自動的に検証されます。

```bash
python3 manual_tests/manual_test_init_dest.py
```

スクリプトは各ステップの成功・失敗を標準出力に色付きで表示します。すべてのケースで `[PASS]` が表示されればテスト合格です。
