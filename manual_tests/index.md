# 手動テスト実装方針

このドキュメントは `manual_tests/` ディレクトリ内の手動テストスクリプトの実装ガイドラインについて説明します。

## 1. スクリプト構造とエラーハンドリング

*   **即時終了:** スクリプトはエラー発生時に即座に終了するように構成してください（例: Bashなら `set -e`、Pythonなら例外を送出）。
*   **クリーンアップ:** 終了時に一時ディレクトリやリポジトリをクリーンアップするために `trap` (Bash) や `try...finally` (Python) を使用してください。
*   **モジュール化:** 一般的な検証手順（例: `assert_git_branch`）は関数にカプセル化して可読性を高めてください。

## 2. 出力とログ

*   **色分けルール:** テストスクリプトが出力する指示テキスト、ステータスメッセージ、ログはすべて **緑色** で表示する必要があります。
    *   **実装:** `interactive_runner.py` の `print_green` 関数または同等のロジックを使用してください。
    *   **理由:** スクリプトの出力とテスト対象ツール（`git`, `mstl` など）の出力を区別するため。
    *   失敗時のメッセージは **赤色** で表示してください。
*   **詳細出力 (`--verbose`):** `mstl`, `mstl-gh` コマンドを実行する際は必ず `--verbose` フラグを使用し、実行されるコマンドが画面に見えるようにしてください。
*   **操作状況の可視化:** ユーザーが現在の操作状況（何が実行されているか）を画面で確認できるようにしてください。
*   **テーブル出力:** テーブル形式の出力は Markdown 形式にしてください。

## 3. ユーザー対話と安全性

*   **パイプ入力の禁止:** ツールへの入力値（設定や確認応答など）をパイプ (`|`) や `stdin` リダイレクトで流し込むことは行わないでください。
    *   対話が必要な場合は、ユーザーに入力を促すか、フラグ（例: `--title`, `--body`）を使用してください。
    *   `pty` (Pseudo-terminal) を使用して対話環境をシミュレートすることは許容されますが、自動化よりもユーザーによる手動確認を優先してください。
*   **事前確認:** 手動テストの開始時に、テスト手順と予想される変更内容（作成されるリポジトリなど）をユーザーに提示し、続行する前に明示的な確認（例：「これらのリポジトリを作成してテストを実行しますか？ [Y/n]」）を求めてください。
*   **GitHubリポジトリの作成:**
    1.  スクリプトはまず、作成されるリポジトリ/ディレクトリのリストを生成または決定する必要があります。
    2.  このリストをユーザーに表示します。
    3.  作成に進む前にユーザーの確認を求めてください。
    *   リファレンス実装として `manual_test_gh_pr_create.py` を参照してください。

## 4. 一貫性

*   可能な限り `interactive_runner.py` を使用して、「セットアップ -> 実行 -> 検証 -> クリーンアップ」のワークフローを標準化してください。

## 5. 仕様の整合性 (Specification Integrity)

*   **仕様変更の禁止:** テストケースの都合でバイナリの仕様を変更することは固く禁じられています。
    *   テスタビリティのために設計を調整すること（例：依存性の注入など）は許容されますが、テストのためだけにコアの仕様そのもの（例：設定ファイルのパス解決ロジック）を変更することは認められません。
    *   テスト環境側で工夫（例：設定ファイルの配置場所を調整する、フラグを使用するなど）して対応してください。
